<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Amazon Intelligence Demo</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" />
    <style>
        textarea { width: 100%; height: 120px; }
    </style>
</head>
<body class="bg-light">
<div id="app" class="container py-4">
    <h1 class="mb-4">Amazon Intelligence Demo</h1>
    <ul class="nav nav-tabs mb-3">
        <li class="nav-item" v-for="t in tabs" :key="t">
            <button class="nav-link" :class="{active: active===t}" @click="active=t">{{ t }}</button>
        </li>
    </ul>

    <div v-if="active==='Competitor Monitor'" class="mb-3">
        <div class="input-group mb-2">
            <input v-model="compInput" placeholder="Enter ASIN or URL" class="form-control" />
            <button @click="scrape" class="btn btn-primary">采集</button>
        </div>
        <pre class="bg-white p-3 border rounded">{{ result }}</pre>
    </div>

    <div v-if="active==='Review Analysis'" class="mb-3">
        <textarea v-model="reviewInput" placeholder="One review per line" class="form-control mb-2"></textarea>
        <button @click="analyzeReview" class="btn btn-primary mb-2">分析</button>
        <pre class="bg-white p-3 border rounded">{{ reviewResult }}</pre>
    </div>

    <div v-if="active==='Listing Optimizer'" class="mb-3">
        <div class="input-group mb-2">
            <input v-model="listingTitle" placeholder="Listing Title" class="form-control" />
            <button @click="optimizeListing" class="btn btn-primary">优化</button>
        </div>
        <pre class="bg-white p-3 border rounded">{{ optimizeResult }}</pre>
    </div>

    <div v-if="active==='Customer Service'" class="mb-3">
        <div class="input-group mb-2">
            <input v-model="question" placeholder="Customer question" class="form-control" />
            <button @click="askService" class="btn btn-primary">回复</button>
        </div>
        <pre class="bg-white p-3 border rounded">{{ serviceResult }}</pre>
    </div>
</div>
<script>
const { createApp } = Vue;
createApp({
    data() {
        return {
            tabs: ['Competitor Monitor','Review Analysis','Listing Optimizer','Customer Service'],
            active: 'Competitor Monitor',
            compInput: '',
            reviewInput: '',
            listingTitle: '',
            question: '',
            result: {},
            reviewResult: {},
            optimizeResult: {},
            serviceResult: {}
        };
    },
    methods: {
        async scrape() {
            const params = new URLSearchParams();
            if (this.compInput.startsWith('http')) {
                params.append('url', this.compInput);
            } else {
                params.append('asin', this.compInput);
            }
            const res = await fetch('/api/scrape?' + params.toString());
            this.result = await res.json();
        },
        async analyzeReview() {
            const res = await fetch('/api/review_analysis', {
                method: 'POST',
                headers: {'Content-Type':'application/json'},
                body: JSON.stringify({reviews: this.reviewInput.split('\n').filter(Boolean)})
            });
            this.reviewResult = await res.json();
        },
        async optimizeListing() {
            const res = await fetch('/api/listing_optimizer', {
                method: 'POST',
                headers: {'Content-Type':'application/json'},
                body: JSON.stringify({title: this.listingTitle})
            });
            this.optimizeResult = await res.json();
        },
        async askService() {
            const res = await fetch('/api/customer_service', {
                method: 'POST',
                headers: {'Content-Type':'application/json'},
                body: JSON.stringify({question: this.question})
            });
            this.serviceResult = await res.json();
        }
    }
}).mount('#app');
</script>
</body>
</html>
